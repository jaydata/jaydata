<!DOCTYPE html>
<html>
<head>
    <title>JayData unit tests</title>

    <link rel="stylesheet" href="Scripts/qUnit/qunit.css" type="text/css" media="screen" />

    <script type="text/javascript" src="Scripts/qUnit/qunit.js"></script>
    <script type="text/javascript" src="Scripts/jquery-1.8.0.js"></script>
    <script type="text/javascript" src="Scripts/jquery.validate.js"></script>
    <script type="text/javascript" src="Scripts/knockout-2.1.0.js"></script>
    <script type="text/javascript" src="Scripts/angular-1.2.0-rc2.js"></script>
    <!--    <script src="3rdparty/kendo/src/js/kendo.core.js"></script>
    <script src="3rdparty/kendo/src/js/kendo.data.js"></script>-->
    <script type="text/javascript" src="Scripts/kendo.all.min.js"></script>
    <script type="text/javascript" src="Scripts/acorn.js"></script>
<!--    <script type="text/javascript" src="Scripts/esprima.js"></script>-->

    <!--************************************************************************************-->
    <script type="text/javascript" src="TypeSystem/initializeJayDataClient.js"></script>
    <script type="text/javascript" src="TypeSystem/initializeJayData.js"></script>
    <script type="text/javascript" src="TypeSystem/utils.js"></script>
    <script type="text/javascript" src="TypeSystem/PreHtml5Compatible.js"></script>
    <script type="text/javascript" src="JayService/Scripts/datajs-1.1.0-patched.js"></script>
<!--    <script type="text/javascript" src="TypeSystem/JayLint.js"></script>-->
    <script type="text/javascript" src="TypeSystem/Exception.js"></script>
    <script type="text/javascript" src="TypeSystem/TypeSystem.js"></script>
    <script type="text/javascript" src="TypeSystem/Trace/Trace.js"></script>
    <script type="text/javascript" src="TypeSystem/Trace/Logger.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Types.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/SimpleBase.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geospatial.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geography.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geometry.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Guid.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Blob.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/EdmTypes.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Converter.js"></script>
    <script type="text/javascript" src="TypeSystem/Extensions.js"></script>
    <!--*******************************Expressions****************************************-->
<!--    <script type="text/javascript" src="Types/Expressions/ASTParser.js"></script>-->
    <script type="text/javascript" src="Types/Expressions/ExpressionNode2.js"></script>

    <script type="text/javascript" src="Types/Expressions/ArrayLiteralExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/CallExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/CodeParser.js"></script>
    <script type="text/javascript" src="Types/Expressions/ConstantExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/FunctionExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/ObjectFieldExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/ObjectLiteralExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/PagingExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/ParameterExpression.js"> </script>
    <script type="text/javascript" src="Types/Expressions/PropertyExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/SimpleBinaryExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/ThisExpression.js"></script>

    <script type="text/javascript" src="Types/Expressions/Visitors/ExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/GlobalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LocalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LambdaParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterResolverVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LogicalSchemaBinderVisitor.js"></script>

    <script type="text/javascript" src="Types/Expressions/Visitors/ExpTreeVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/SetExecutableVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ExecutorVisitor.js"></script>

    <script type="text/javascript" src="Types/Expressions/ExpressionBuilder.js"></script>

    <script type="text/javascript" src="Types/Expressions/EntityExpressions/AssociationInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeToEntityConverter.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ComplexTypeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityContextExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ExpressionMonitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntitySetExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ServiceOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/FrameOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/FilterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/IncludeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/MemberInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/OrderExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ParametricQueryExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ProjectionExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryExpressionCreator.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryParameterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/RepresentationExpression.js"></script>

    <script type="text/javascript" src="Types/Expressions/ContinuationExpressionBuilder.js"></script>

    <!--******************************* Validation ****************************************-->
    <script type="text/javascript" src="Types/Validation/EntityValidationBase.js"></script>
    <script type="text/javascript" src="Types/Validation/EntityValidation.js"></script>
    <!--******************************* Notification ****************************************-->
    <script type="text/javascript" src="Types/Notifications/ChangeDistributorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollectorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeDistributor.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollector.js"></script>

    <!--******************************* Types ****************************************-->
    <script type="text/javascript" src="Types/Access.js"></script>
    <script type="text/javascript" src="Types/Promise.js"></script>
    <script type="text/javascript" src="Types/Entity.js"></script>
    <script type="text/javascript" src="Types/EntityContext.js"></script>
    <script type="text/javascript" src="Types/QueryProvider.js"></script>
    <script type="text/javascript" src="Types/ModelBinder.js"></script>
    <script type="text/javascript" src="Types/QueryBuilder.js"></script>
    <script type="text/javascript" src="Types/Query.js"></script>
    <script type="text/javascript" src="Types/Queryable.js"></script>
    <script type="text/javascript" src="Types/EntitySet.js"></script>

    <script type="text/javascript" src="Types/AuthEntityContext.js"></script>
    <script type="text/javascript" src="Types/EntityState.js"></script>
    <script type="text/javascript" src="Types/EntityAttachModes.js"></script>
    <script type="text/javascript" src="Types/EntityStateManager.js"></script>
    <script type="text/javascript" src="Types/ItemStore.js"></script>
    <script type="text/javascript" src="Types/StorageProviderLoader.js"></script>
    <script type="text/javascript" src="Types/StorageProviderBase.js"></script>
    <script type="text/javascript" src="Types/ServiceOperation.js"></script>

    <script type="text/javascript" src="Types/Transaction.js"></script>
    <script type="text/javascript" src="Types/EntityWrapper.js"></script>
    <script type="text/javascript" src="JaySvcUtil/JaySvcUtil.js"></script>
    <script type="text/javascript" src="Types/JayStorm.js"></script>

    <!--******************************* Ajax*********************************************-->
    <script type="text/javascript" src="Types/Ajax/jQueryAjaxWrapper.js"></script>
    <script type="text/javascript" src="Types/Ajax/WinJSAjaxWrapper.js"></script>
    <script type="text/javascript" src="Types/Ajax/ExtJSAjaxWrapper.js"></script>
    <script type="text/javascript" src="Types/Ajax/AjaxStub.js"></script>

    <!--******************************* DbClient ****************************************-->
    <script type="text/javascript" src="Types/DbClient/DbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/DbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNjClient/SqLiteNjCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNjClient/SqLiteNjConnection.js"></script>

    <script type="text/javascript" src="Types/StorageProviders/modelBinderConfigCompiler.js"></script>
    <!--******************************* StorageProvider - sqLite ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteStorageProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlProjectionCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlExpressionMonitor.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlFilterCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/ModelBinder/sqLite_ModelBinderCompiler.js"></script>
    <!--******************************* StorageProvider - oData ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataWhereCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProjectionCompiler.js"></script>
    <!--******************************* StorageProvider - IndexDb ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/IndexedDB/IndexedDBConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/IndexedDB/IndexedDBStorageProvider.js"></script>

    <!--******************************* Authentication???? ****************************************-->
    <script type="text/javascript" src="Types/Authentication/AuthenticationBase.js"></script>
    <script type="text/javascript" src="Types/Authentication/Anonymous.js"></script>
    <script type="text/javascript" src="Types/Authentication/FacebookAuth.js"></script>

    <!--******************************* StorageProvider - Facebook ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/user.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/friend.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/page.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQLContext.js"></script>

    <!--******************************* StorageProvider - YQL ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/geo.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/YQLContext.js"></script>

    <!--******************************* StorageProvider - inMemory ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryFunctionCompiler.js"></script>

    <!--******************************* StorageProvider - webApi ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/WebApi/WebApiConverter.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/WebApi/WebApiProvider.js"></script>

    <!--******************************* OData Parser ****************************************-->
    <script type="text/javascript" src="oDataParser/RequestExpressionBuilder.js"></script>
    <script type="text/javascript" src="oDataParser/RequestLexer.js"></script>
    <script type="text/javascript" src="oDataParser/RequestParser.js"></script>

    <script type="text/javascript" src="oDataParser/EntityExpressionBuilder.js"></script>
    <script type="text/javascript" src="oDataParser/ODataEntityExpressionBuilder.js"></script>
    <script type="text/javascript" src="oDataParser/Visitors/ObjectLiteralBuilderVisitor.js"></script>

    <!--******************************* jsExtensions ****************************************-->
    
        <script type="text/javascript">

            function checkArgs(cb, t, tranIsOptional) {
                var funcWrapper = function () {
                    var hasTran = Array.prototype.some.call(arguments, function (p) { return p instanceof $data.Transaction; });
                    if (t === undefined && hasTran) {
                        ok(false, 'transaction in result');
                    } else if (!tranIsOptional && t !== undefined && !hasTran) {
                        ok(false, 'transaction not in result');
                    }
                    cb.apply(this, arguments);
                };
                return funcWrapper;
            }


            var operators = [
                { name: 'toArray', cbArg: 0, tArg: 1, base: $data.Queryable },
                { name: 'length', cbArg: 0, tArg: 1, base: $data.Queryable },
                { name: 'count', cbArg: 0, tArg: 1, base: $data.Queryable },
                { name: 'first', cbArg: 2, tArg: 3, base: $data.Queryable },
                { name: 'single', cbArg: 2, tArg: 3, base: $data.Queryable },
                { name: 'saveChanges', cbArg: 0, tArg: 1, base: $data.EntityContext }
            ];
            operators.orig = {};

            operators.forEach(function (operator) {
                var op = operator.name;
                var base = operator.base;

                operators.orig[op] = base.prototype[op];
                base.prototype[op] = function () {
                    var cb = $data.PromiseHandlerBase.createCallbackSettings(arguments[operator.cbArg]);
                    arguments[operator.cbArg] = {};
                    arguments[operator.cbArg].success = checkArgs(cb.success, arguments[operator.tArg]);
                    arguments[operator.cbArg].error = checkArgs(cb.error, arguments[operator.tArg], true);

                    return operators.orig[op].apply(this, arguments);
                }

            });

    </script>
    
    
    <script type="text/javascript" src="JayDataModules/deferred.js"></script>
    <script type="text/javascript" src="JayDataModules/formBinder.js"></script>
    <script type="text/javascript" src="JayDataModules/template.js"></script>
    <script type="text/javascript" src="JayDataModules/validate.js"></script>
    <script type="text/javascript" src="JayDataModules/knockout.js"></script>
    <script type="text/javascript" src="JayDataModules/kendo.js"></script>
    <script type="text/javascript" src="JayDataModules/inMemory.js"></script>
    <script type="text/javascript" src="JayDataModules/angular.js"></script>

    <!--************************************************************************************-->



    <!--**********************************UNIT TESTS****************************************-->
    <script src="NewsReaderContext.js" type="text/javascript"></script>

    <script src="UnitTests/converterTests.js" type="text/javascript"></script>
    <script src="UnitTests/inMemoryProviderTests.js" type="text/javascript"></script>
    <script src="UnitTests/storageModelTests.js" type="text/javascript"></script>
    <script src="UnitTests/typeSystemTests.js" type="text/javascript"></script>
    <script src="UnitTests/EntityContextTests.js" type="text/javascript"></script>
    <script src="UnitTests/dataDistributeTest.js" type="text/javascript"></script>
    <script src="UnitTests/ValidationTests.js" type="text/javascript"></script>
    <script src="UnitTests/indexedDbProviderTest.js" type="text/javascript"></script>

    <script src="UnitTests/knockoutTests.js" type="text/javascript"></script>
    <script src="UnitTests/kendoTests.js" type="text/javascript"></script>
    <script src="UnitTests/setOperationTests.js" type="text/javascript"></script>

    <script src="UnitTests/sqLiteProviderTests.js" type="text/javascript"></script>
    <script src="UnitTests/sqLiteCompilerTests.js" type="text/javascript"></script>
    <script src="UnitTests/sqLiteCRUDTests.js" type="text/javascript"></script>
    <script src="UnitTests/LocalItemStoreTests.js" type="text/javascript"></script>

    <script src="UnitTests/oDataProviderTests.js" type="text/javascript"></script>

    <!--Commented out because of popups-->
    <!--<script src="UnitTests/oDataProviderTests_auth.js" type="text/javascript"></script>-->

    <script src="UnitTests/T1.js" type="text/javascript"></script>
    <script src="UnitTests/T3.js" type="text/javascript"></script>
    <script src="UnitTests/T4.js" type="text/javascript"></script>
    <script src="UnitTests/webApiTests.js" type="text/javascript"></script>
    <script src="UnitTests/dataServiceVersionTests.js" type="text/javascript"></script>
    <script src="UnitTests/TypesTest.js" type="text/javascript"></script>
    <script src="UnitTests/CollectionTests.js" type="text/javascript"></script>
    <script src="UnitTests/T2.js" type="text/javascript"></script>
    <script src="UnitTests/loadPropertyTests.js" type="text/javascript"></script>
    <script src="UnitTests/ValidatonPluginTest.js" type="text/javascript"></script>
    <script src="UnitTests/promiseTests.js" type="text/javascript"></script>
    <script src="UnitTests/JaySvcUtilTests.js" type="text/javascript"></script>

    <script src="UnitTests/FaceBookProviderTests.js" type="text/javascript"></script>
    <script src="UnitTests/YQLProviderTests.js" type="text/javascript"></script>

    <script type="text/javascript" src="oDataParser/currentTests.js"></script>
    <script type="text/javascript" src="oDataParser/lexerTests.js"></script>
    <script type="text/javascript" src="oDataParser/parserTests.js"></script>
    <script type="text/javascript" src="oDataParser/expressionParserTests.js"></script>

    <!--<script src="UnitTests/AuthEntityContextTests.js" type="text/javascript"></script>-->
    <!--//TODO: fixed authentication context bugs-->

    <script src="UnitTests/angularTests.js" type="text/javascript"></script>

</head>
<body>
    <h1 id="qunit-header">JayData unit tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar">
    </div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests">
    </ol>
    <div id="qunit-fixture">
        test markup, will be hidden
    </div>
</body>
</html>
